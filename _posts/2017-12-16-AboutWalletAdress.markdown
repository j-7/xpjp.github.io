---
layout: post
title:  ",balanceで表示されるXp-Bot管理ウォレットの残高と、Explorerで表示される残高の差異についての見解"
date:   2017-12-16 14:30:00 +0900
categories: official
author: 依田
---
`,balance`で表示される残高とExplorerで表示される残高の違いについて説明します。  

Xp-Botの仕様について開発者の.Lexさんは公開しておりません。あくまでも推測であることをご承知おきください。  

`,balance`で表示されるアドレスは、入金先アドレスに過ぎず(本家問い合わせで確定)、`,rain`や`,tip`などによってあちこちのアドレスに分かれてしまいガチャガチャになっていくものと思います。  
このアドレスにくっついてるゲストアドレスを追っていくと、大元のBot管理ウォレットに行き着き、そこで12000ものアドレスが紐付けされているように見えます。  
`,balance`の残高は、トラザクションごとに別のデータベースで管理しているものかと思われます。  
開発者はソースを公開していませんので、また記事執筆者は技術を持ち合わせておりませんので、正確な回答と言い切れなく申し訳なく思います。  

もう一度、見解を整理しますと、「`,balance`のアドレスは入金先を示すものに過ぎず、実際の残高と一致するとは限らない。したがって、Explorerで身に覚えがない取引があったとしても`,balance`には影響がない」ということです。  

また、非常に多くのお問い合わせをいただいておりますXp-Bot停止中の残高表示につきましては「できません」というのが回答となります。  
Explorerの残高は、あくまでも入金用アドレスに残ったものであり、内部処理の結果としてのものです。残高は別途データベースに記録してあるので、差異があっても`,balance`表示のもので保障されます。  

また、議論の中で、非常に細かい入出金が見受けられるとのご指摘をいただきました。これは、トラザクションの処理に伴う手数料と思われます。  
`,tip`や`,rain`においてはXp-Bot側では手数料の表示を行っておらず、また同様に残高から引かれている様子も表からは見られません。  
しかし、実際内部では細かい金額の出し入れが行われていることから、実際支払われているであろう手数料について、このような推測を立てました。  

・ユーザーの入金用アドレス(≠ウォレット残高)から内部処理として徴収している  

一見問題がありそうですが、実は正しい処理と考えます。  
残高そのものは別途データベースで記録されており、仮に全ユーザーが同時に全ての残高を引き落とさない限り、支払い不能となることはないと思われます。  
また、実際にそのような状況に陥ったとしても、手数料準備金をあらかじめ用意しておくことで支払い不能となる事態は避けられるということが根拠となります。  
Xp-Botがメンテナンス中の細かい入出金については、負荷テストと思われます。  
つまり、「`,balance`の残高の帳尻を合わせるための処理」であるということです。  

以上、推測ではありますが回答とさせていただきます。  

メンバーのみなさまに多大なるご心配をおかけしたことをお詫び申し上げます。  

今後ともXPとXP-JPをよろしくお願いいたします。  
